var vt=Object.defineProperty;var Nt=(a,e,t)=>e in a?vt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var n=(a,e,t)=>Nt(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const Dt="_container_10r43_1",bt="_flex_10r43_7",Ot="_flexColumn_10r43_11",_t="_alignCenter_10r43_15",wt="_center_10r43_19",Pt="_justifyBetween_10r43_28",Lt="_gap30_10r43_37",yt="_gap20_10r43_41",Mt="_gap10_10r43_45",xt="_widthFull_10r43_58",Gt="_marginInline10_10r43_84",o={container:Dt,flex:bt,flexColumn:Ot,alignCenter:_t,center:wt,justifyBetween:Pt,gap30:Lt,gap20:yt,gap10:Mt,widthFull:xt,marginInline10:Gt},Bt="_headerPrimary_7wg5e_1",Wt="_header_7wg5e_1",Vt="_icon_7wg5e_23",tt={headerPrimary:Bt,header:Wt,icon:Vt},R={TO_GARAGE:"To garage",TO_WINNERS:"To winners",PREVIOUS:"Previous page",NEXT:"Next page",FIRST:"First page",LAST:"Last page",START_RACE:"Start race",RESET:"Reset",GENERATE_CARS:"Generate cars",CREATE:"Create",DELETE:"Delete",EDIT:"Edit",START_ENGINE:" Start engine",STOP_ENGINE:"Stop engine",CROSS:"cross",CONFIRM:"confirm",ORDER:"Change sort order",THEME:"theme"},Ft={THEME:"Change theme"},P={NAMESPACE_SVG:"http://www.w3.org/2000/svg",NAMESPACE_XLINK:"http://www.w3.org/1999/xlink",QUALIFIED_NAME:"xlink:href",ROLE:"img"},u="./sprite.svg#",D={SOUND:{ON:u+"sound-on",OFF:u+"sound-off"},THEME:{ON:u+"theme-light",OFF:u+"theme-dark"},DELETE:u+"delete",BACK:u+"back",START_ENGINE:u+"start",STOP_ENGINE:u+"stop",ADD:u+"add",CAR:u+"car2",EDIT:u+"edit",CROSS:u+"cross",CONFIRM:u+"confirm",FIRST:u+"doubleArrowLeft",LAST:u+"doubleArrowRight",NEXT:u+"arrowRight",PREVIOUS:u+"arrowLeft",START_RACE:u+"startRace",RESET:u+"reset",GENERATE_CARS:u+"wheel",ORDER:u+"sort"},Ut={SUBMIT:"submit"},Ht="Async Race",kt="radomskaia--async-race--",m=0,f=1,rt=2,mt="",$t=100,lt=1e3,K={HASH:"#",BRACKET:{OPEN:"(",CLOSE:")"}},W={RGB:"RGB",RANGE:256,HEX_BASE:16,HEX_LENGTH:2,ZERO_PAD:"0"},O={HOME:"/",WINNERS:"/winners",NOT_FOUND:"404"},k={ROUTE_NOT_FOUND:"Route not found",NOT_INITIALIZED:"Class is not initialized",PAGE_NOT_FOUND:"Sorry, page not found",INVALID_DATA:"Invalid data"};var Z=(a=>(a.WINNERS="/winners",a.GARAGE="/garage",a.ENGINE="/engine",a))(Z||{});const B={NAME:"name",COLOR:"color",ID:"id"},ht={VELOCITY:"velocity",DISTANCE:"distance"},dt={DATA:"data",COUNT:"count"},$={ID:"id",WINS:"wins",TIME:"time"},jt=7,Xt=10,Kt="http://localhost:3000",qt={"Content-Type":"application/json"},Yt="X-Total-Count",Qt=4e3,p={PATH_REQUIRED:"Path is required",INVALID_DATA:"Invalid data",NO_LISTENERS:"No listeners for event type",ABORTED:"Aborted",RACE_STOPPED:"Race stopped by user",FETCH:"Error while fetching data: ",SERVICE_NOT_FOUND:"Service not found",INVALID_SERVICE:"Invalid service",CONTAINER_NOT_FOUND:"Container not found"},nt={FILL:"fill",ARIA_LABEL:"aria-label"},Zt="Winner is",Jt="with time",pt={GARAGE:"Garage",WINNERS:"Winners"},zt=["ID","Car","Name","Wins","Time"],Et={COUNT:"x",SECONDS:"s"},te="forwards",b=class b{constructor(){n(this,"services");n(this,"factory");this.services=new Map,this.factory=new Map}static getInstance(){return b.instance||(b.instance=new b),b.instance}static isServiceType(e,t){return t.name===e}register(e,t){this.factory.set(e,t)}getService(e){let t=this.services.get(e);if(!t){const s=this.factory.get(e);if(!s)throw new Error(`${p.SERVICE_NOT_FOUND} ${e}`);t=new s,this.services.set(e,t)}if(!b.isServiceType(e,t))throw new Error(`${p.INVALID_SERVICE} ${e}`);return t}};n(b,"instance");let E=b;var c=(a=>(a.API="apiService",a.RACE="raceService",a.ROUTER="router",a.EVENT_EMITTER="eventEmitter",a.WINNER="winnerService",a.GARAGE="garageService",a.ENGINE="engineService",a.STORAGE="sessionStorage",a.VALIDATOR="validator",a))(c||{});class C{constructor(e){n(this,"element");n(this,"listeners",new Map);n(this,"registerEvent",(e,t)=>{this.listeners.has(e)||this.listeners.set(e,[]);const s=this.listeners.get(e);s==null||s.push(t),E.getInstance().getService(c.EVENT_EMITTER).subscribe(e,this)});n(this,"addTextContent",(e,t)=>{t=t??this.element,t.textContent=e});n(this,"createDOMElement",({tagName:e,classList:t,textContent:s,attributes:r})=>{const i=document.createElement(e);return t&&this.addClassList(t,i),r&&this.addAttributes(r,i),s&&this.addTextContent(s,i),i});n(this,"addClassList",(e,t)=>{t=t??this.element,t.classList.add(...e)});n(this,"addAttributes",(e,t)=>{t=t??this.element;for(const[s,r]of Object.entries(e))t.setAttribute(s,r)});n(this,"createSVG",({path:e,classList:t,attributes:s})=>{const r=document.createElementNS(P.NAMESPACE_SVG,"svg");this.addAttributes({...s,role:P.ROLE},r),this.addClassList(t,r);const i=document.createElementNS(P.NAMESPACE_SVG,"use");return i.setAttributeNS(P.NAMESPACE_XLINK,P.QUALIFIED_NAME,e),r.append(i),{use:i,svg:r}});this.element=this.createElement(e)}update(e){const t=this.listeners.get(e.type);if(!t){console.info(p.NO_LISTENERS);return}for(const s of t)s(e.data)}getElement(){return this.element}appendElement(...e){this.element.append(...e)}clearElement(){this.element.replaceChildren()}}const ee="_button_xilkn_1",se="_actionButton_xilkn_11",ae="_iconButton_xilkn_32",re="_settings_xilkn_41",J={button:ee,actionButton:se,iconButton:ae,settings:re};var h=(a=>(a.listUpdated="listUpdated",a.winnerDetected="winnerDetected",a.raceStarted="raceStarted",a.raceEnded="raceEnded",a.singleRaceStarted="singleRaceStarted",a.singleRaceEnded="singleRaceEnded",a.updateCar="updateCar",a.paginationUpdated="paginationUpdated",a.changeRoute="changeRoute",a.enginesStarted="enginesStarted",a))(h||{});class St extends C{constructor(t){super();n(this,"wasDisabled",{isDisabled:!1,singleStack:[]});t&&this.addListener(t)}toggleDisabled(){this.disabledElement(!this.element.disabled)}disabledElement(t){this.element.disabled=t}addListener(t){this.element.addEventListener("click",t)}createElement(){return this.createDOMElement({tagName:"button",classList:[J.button]})}addRaceListeners(t,s=!1){s?(this.registerEvent(h.singleRaceStarted,r=>{r===t&&(this.wasDisabled.singleStack.push(!0),this.wasDisabled.isDisabled=this.element.disabled,this.disabledElement(!0))}),this.registerEvent(h.singleRaceEnded,r=>{r!==t&&this.wasDisabled||(this.wasDisabled.singleStack.pop(),this.disabledElement(!1))})):this.registerEvent(h.singleRaceStarted,()=>{this.wasDisabled.isDisabled=this.element.disabled,this.disabledElement(!0)}),this.registerEvent(h.raceEnded,()=>{this.wasDisabled.isDisabled&&this.wasDisabled.singleStack.length!==m||this.disabledElement(!1)}),this.registerEvent(h.raceStarted,()=>{this.wasDisabled.isDisabled=this.element.disabled,this.disabledElement(!0)})}}class G extends St{constructor(t,s){super(s);n(this,"useSVGIcon");this.element.title=t.title;const{use:r,svg:i}=this.createSVG({path:t.path,classList:[J.iconButton,...t.classList],attributes:{title:t.title,[nt.ARIA_LABEL]:t.title}});this.useSVGIcon=r,this.appendElement(i)}}class ne extends G{constructor(e){if(!e.path)throw new Error(p.PATH_REQUIRED);super({title:e.title,classList:e.classList??[],path:e.path}),this.addClassList([J.settings])}togglePath(e){const t=e?this.pathOff:this.pathOn;this.useSVGIcon.setAttributeNS(P.NAMESPACE_XLINK,P.QUALIFIED_NAME,t)}addToggleListener(e){this.addListener(()=>{e.toggle()})}}class ie extends ne{constructor(){const t=D.THEME.ON,s=Ft.THEME;super({path:t,title:s});n(this,"pathOn");n(this,"pathOff",D.THEME.OFF);n(this,"title");this.title=s,this.pathOn=t}}class oe{constructor(e){this.button=e,this.button=e}}const ce="(prefers-color-scheme: dark)",le="data-theme",y=class y extends oe{constructor(t){super(t);n(this,"isOff");n(this,"mediaQueryList");this.mediaQueryList=globalThis.matchMedia(ce),this.isOff=this.mediaQueryList.matches,this.changeTheme(this.isOff),this.mediaQueryList.addEventListener("change",s=>{this.changeTheme(s.matches)})}static getInstance(t){if(!y.instance){if(!t)throw new Error(k.NOT_INITIALIZED);y.instance=new y(t)}return y.instance}toggle(){this.isOff=!this.isOff,this.changeTheme(this.isOff)}changeTheme(t){this.button.togglePath(t),document.body.toggleAttribute(le,t)}};n(y,"instance");let et=y;class ft extends St{constructor(e,t){super(t),this.element.textContent=e,this.addClassList([J.actionButton])}}class he extends C{constructor(){super();n(this,"settingsButton",{theme:{button:ie,action:et}});n(this,"settingsWrapper");n(this,"pagesWrapper");n(this,"disabledConfig",{[R.TO_WINNERS]:O.WINNERS,[R.TO_GARAGE]:O.HOME});this.settingsWrapper=this.createSettingsWrapper(),this.pagesWrapper=this.createPagesWrapper(),this.appendElement(this.pagesWrapper,this.settingsWrapper)}addSettingsButton(t){const s=new this.settingsButton[t].button,r=this.settingsButton[t].action.getInstance(s);return s.addToggleListener(r),this.settingsWrapper.append(s.getElement()),this}addPageButton(t){const s=E.getInstance().getService(c.ROUTER),r=new ft(t);return r.registerEvent(h.changeRoute,i=>{const d=this.disabledConfig[t]===i;r.disabledElement(d)}),r.addListener(()=>{s.navigateTo(this.disabledConfig[t])}),t!==R.TO_GARAGE&&r.addRaceListeners(),this.pagesWrapper.append(r.getElement()),this}createElement(){const t=this.createDOMElement({tagName:"header",classList:[tt.header,o.container,o.flex,o.alignCenter,o.justifyBetween,o.widthFull]}),s=this.createDOMElement({tagName:"h1",textContent:Ht,classList:[tt.headerPrimary]});return t.append(s),t}createSettingsWrapper(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.center,o.gap30,o.marginInline10,tt.icon]})}createPagesWrapper(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.center,o.gap30]})}}const de="_buttonWrapper_1l43k_1",Ee="_uiPanel_1l43k_7",gt={buttonWrapper:de,uiPanel:Ee},ge="_carsList_13ax1_1",ue="_icon_13ax1_10",me="_carIcon_13ax1_15",pe="_carName_13ax1_20",Se="_carColor_13ax1_36",fe="_formButton_13ax1_55",Ae="_form_13ax1_55",Re="_carPanel_13ax1_86",I={carsList:ge,icon:ue,carIcon:me,carName:pe,carColor:Se,formButton:fe,form:Ae,carPanel:Re};class At extends C{constructor(t){super();n(this,"defaultValue",mt);t&&(this.element.value=t)}get value(){return this.element.value}set value(t){this.element.value=t}setDefaultValue(){this.defaultValue=this.element.value}resetValue(){this.element.value=this.defaultValue}toggleDisabled(){this.element.disabled=!this.element.disabled}createElement(){return this.createDOMElement({tagName:"input"})}}const Ce="Car name",Rt={TEXT:"text",COLOR:"color"},q={CAR_NAME:"name",CAR_COLOR:"color"};class Te extends At{constructor(e){super(e),this.element.type=Rt.TEXT,this.addClassList([I.carName]),this.element.placeholder=Ce,this.element.name=q.CAR_NAME,this.element.required=!0}}class Ie extends At{constructor(e){super(e),this.element.type=Rt.COLOR,this.addClassList([I.carColor]),this.element.name=q.CAR_COLOR}}const j={Tesla:["Model X","Model S","Model 3","Model Y","Cybertruck"],BMW:["i3","i4","i8","M4","X5"],Audi:["A3","A4","Q7","Q5","e-tron"],Mercedes:["A-Class","C-Class","E-Class","S-Class","GLC"],Ford:["Mustang","F-150","Explorer","Focus","Bronco"],Toyota:["Camry","Corolla","Highlander","RAV4","Prius"],Honda:["Civic","Accord","CR-V","Pilot","Odyssey"],Chevrolet:["Malibu","Impala","Tahoe","Silverado","Bolt EV"],Volkswagen:["Golf","Passat","Tiguan","ID.4","Beetle"],Nissan:["Altima","Maxima","370Z","Leaf","Rogue"],Hyundai:["Elantra","Sonata","Tucson","Santa Fe","Kona"]},ve=Object.keys(j);function Ne(){return Math.floor(Math.random()*W.RANGE).toString(W.HEX_BASE).padStart(W.HEX_LENGTH,W.ZERO_PAD)}function it(){let a=`${K.HASH}`;for(let e=m;e<W.RGB.length;e++)a+=Ne();return a}function De(){const a=Math.floor(Math.random()*Object.keys(j).length),e=ve[a],t=Math.floor(Math.random()*j[e].length),s=j[e][t];return`${e} ${s}`}function g(a){if(a instanceof Error){console.warn(a.message);return}if(a instanceof Response){console.warn(a.statusText);return}if(a instanceof DOMException){console.info(a.message);return}console.warn(a)}var T=(a=>(a.sort="sort",a.isASC="isASC",a.garage="Garage",a.winners="Winners",a.carProperties="CarProperties",a))(T||{}),l=(a=>(a.object="object",a.string="string",a.number="number",a.positiveNumber="positiveNumber",a.boolean="boolean",a.responseCarData="responseCarData",a.responseWinnerData="responseWinnerData",a.responseData="responseData",a.raceData="raceData",a.carArray="carArray",a.winnerArray="winnerArray",a.car="car",a.winner="winner",a.carProperties="carProperties",a.modalData="modalData",a.sort="sort",a.fullData="fullData",a))(l||{});class Y extends C{constructor(t){super(t==null?void 0:t.id);n(this,"nameElement");n(this,"colorElement");n(this,"apiService",E.getInstance().getService(c.GARAGE));n(this,"validator",E.getInstance().getService(c.VALIDATOR));const r=E.getInstance().getService(c.STORAGE).load(T.carProperties,l.carProperties);this.nameElement=this.addCarName((t==null?void 0:t.name)??(r==null?void 0:r.name));const i=(t==null?void 0:t.color)??(r==null?void 0:r.color)??it();this.colorElement=new Ie(i),this.appendElement(this.colorElement.getElement(),this.nameElement.getElement())}static createButton(t){return new G({title:R[t],path:D[t],classList:[I.formButton]})}createElement(t){const s=this.createDOMElement({tagName:"form",classList:[I.form]});return this.addClassList([o.flex,o.gap10,o.alignCenter],s),s.addEventListener("submit",r=>this.formHandler(r,t)),s}getFormData(){const t=new FormData(this.element),s=t.get(q.CAR_NAME),r=t.get(q.CAR_COLOR);if(!this.validator.validate(l.string,s)||!this.validator.validate(l.string,r))throw new TypeError(k.INVALID_DATA);return{name:s,color:r}}addCarName(t){const s=new Te(t);return this.appendElement(s.getElement()),s}}var V=(a=>(a.EDIT="EDIT",a.DELETE="DELETE",a.START_ENGINE="START_ENGINE",a.STOP_ENGINE="STOP_ENGINE",a))(V||{}),A=(a=>(a.NEXT="NEXT",a.PREVIOUS="PREVIOUS",a.FIRST="FIRST",a.LAST="LAST",a))(A||{}),Q=(a=>(a.CROSS="CROSS",a.CONFIRM="CONFIRM",a))(Q||{}),F=(a=>(a.START_RACE="START_RACE",a.RESET="RESET",a.GENERATE_CARS="GENERATE_CARS",a))(F||{});class be extends Y{constructor(t){super(t);n(this,"formButtons",[]);n(this,"formButtonsConfig",Q);n(this,"eventEmitter",E.getInstance().getService(c.EVENT_EMITTER));n(this,"id");this.addFormButtons(),this.id=t.id,this.colorElement.getElement().addEventListener("change",()=>{this.eventEmitter.notify({type:h.updateCar,data:{id:this.id,name:this.nameElement.value,color:this.colorElement.value}})})}editHandler(){this.getUpdateState()&&(this.toggleUpdateState(),this.nameElement.getElement().focus(),this.colorElement.setDefaultValue(),this.nameElement.setDefaultValue())}formHandler(t,s){t.preventDefault();let r;try{r=this.getFormData()}catch(i){g(i),this.resetForm();return}this.toggleUpdateState(),this.apiService.updateCar({id:s,...r}).catch(i=>{g(i),this.resetForm()})}getUpdateState(){return this.nameElement.getElement().disabled}toggleUpdateState(){this.nameElement.toggleDisabled(),this.colorElement.toggleDisabled();for(const t of this.formButtons)t.toggleDisabled()}addFormButtons(){this.createFormButtons();const[t,s]=this.formButtons;t.addListener(()=>{this.resetForm(),this.toggleUpdateState()}),this.appendElement(s.getElement(),t.getElement()),this.toggleUpdateState()}resetForm(){this.colorElement.resetValue(),this.nameElement.resetValue(),this.eventEmitter.notify({type:h.updateCar,data:{id:this.id,name:this.nameElement.value,color:this.colorElement.value}})}createFormButtons(){for(const t of Object.values(this.formButtonsConfig)){const s=Y.createButton(t);t===Q.CONFIRM&&(s.getElement().type=Ut.SUBMIT),this.formButtons.push(s)}}}class Oe extends C{constructor(t){super();n(this,"controlsButtons",{});n(this,"buttonsConfig",[{title:V.DELETE,callback:async()=>{await this.garageService.deleteCar(this.id).catch(g),this.eventEmitter.notify({type:h.listUpdated,data:[null]})},action:t=>t.addRaceListeners(this.id)},{title:V.EDIT,callback:()=>{this.form.editHandler()},action:t=>t.addRaceListeners(this.id)},{title:V.START_ENGINE,callback:()=>{this.raceService.startSingleRace(this.id).catch(g)},action:t=>{t.addRaceListeners(this.id,!0)}},{title:V.STOP_ENGINE,callback:()=>{this.raceService.stopSingleRace(this.id).catch(g)},action:t=>this.registerStopButton(t)}]);n(this,"form");n(this,"useElement");n(this,"carElement");n(this,"garageService");n(this,"raceService");n(this,"eventEmitter");n(this,"id");const s=E.getInstance(),r=s.getService(c.VALIDATOR);this.registerEvent(h.updateCar,S=>{if(!r.validate(l.car,S))throw new Error(p.INVALID_DATA);S.id===t.id&&this.updateCarView(S)}),this.raceService=s.getService(c.RACE),this.garageService=s.getService(c.GARAGE),this.eventEmitter=s.getService(c.EVENT_EMITTER),this.form=new be(t),this.id=t.id,this.element.append(this.createCarPanel());const{use:i,svg:d}=this.createSVG({classList:[I.carIcon],path:D.CAR});this.useElement=i,this.carElement=d,this.appendElement(this.carElement),this.updateCarView(t)}getCarElement(){return this.carElement}updateCarView(t){const s=this.useElement;s&&s.setAttribute(nt.FILL,t.color)}createElement(){return this.createDOMElement({tagName:"li",classList:[o.flex,o.flexColumn,o.gap10]})}createCarPanel(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.justifyBetween,o.alignCenter,I.carPanel]});return t.append(this.form.getElement(),this.addControlsButtons()),t}createButtonWrapper(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.alignCenter,o.gap10]})}addControlsButtons(){const t=this.createButtonWrapper();for(const{title:s,callback:r,action:i}of this.buttonsConfig){const d=new G({title:R[s],path:D[s],classList:[I.icon]},r);this.appendElement(d.getElement()),this.controlsButtons[s]=d,t.append(d.getElement()),i(d)}return t}registerStopButton(t){t.registerEvent(h.singleRaceStarted,s=>{s===this.id&&t.disabledElement(!1)}),t.registerEvent(h.raceEnded,()=>{t.disabledElement(!0)}),t.registerEvent(h.singleRaceEnded,s=>{s===this.id&&t.disabledElement(!0)}),t.addListener(()=>t.disabledElement(!0)),t.disabledElement(!0)}}class _e extends C{constructor(){super();n(this,"raceService");n(this,"addCarsList",t=>{var s;this.clearElement(),(s=this.raceService)==null||s.resetCars();for(const r of t)this.addCar(r)});const t=E.getInstance();this.raceService=t.getService(c.RACE),this.raceService.init(this.element);const s=t.getService(c.VALIDATOR);this.registerEvent(h.paginationUpdated,r=>{s.validate(l.carArray,r)&&this.addCarsList(r)})}addCar(t){const s=new Oe(t);this.appendElement(s.getElement()),this.raceService.addCar(t.id,s.getCarElement())}createElement(){return this.createDOMElement({tagName:"ul",classList:[I.carsList,o.flex,o.flexColumn,o.gap20]})}}class we extends Y{constructor(){super(),this.addFormButton();const e=E.getInstance().getService(c.STORAGE);window.addEventListener("beforeunload",()=>{e.save(T.carProperties,this.getFormData())}),this.registerEvent(h.changeRoute,()=>{e.save(T.carProperties,this.getFormData())})}formHandler(e){e.preventDefault();let t;try{t=this.getFormData()}catch(s){g(s);return}this.apiService.createCar(t).then(()=>{this.nameElement.resetValue(),this.colorElement.value=it(),E.getInstance().getService(c.EVENT_EMITTER).notify({type:h.listUpdated,data:[null,!0]})}).catch(g)}addFormButton(){const e=Y.createButton(Q.CONFIRM);this.appendElement(e.getElement()),e.addRaceListeners()}}class Ct extends C{constructor(t){super();n(this,"currentPage");n(this,"buttons",{});n(this,"buttonsConfig",[{name:A.FIRST,callback:()=>{this.setPage(f).catch(g)}},{name:A.PREVIOUS,callback:()=>{let t=this.currentPage-f;t=t<=m?f:t,this.setPage(t).catch(g)}},{name:A.NEXT,callback:()=>{let t=this.currentPage+f;t=Math.min(t,this.lastPage),this.setPage(t).catch(g)}},{name:A.LAST,callback:()=>{this.setPage(this.lastPage).catch(g)}}]);n(this,"currentPageElement");n(this,"counterElement");n(this,"lastPage");const s=E.getInstance().getService(c.STORAGE),r=Number(s.load(t,l.positiveNumber));this.currentPage=r||f,window.addEventListener("beforeunload",()=>{s.save(t,this.currentPage)}),this.registerEvent(h.changeRoute,()=>{s.save(t,this.currentPage)}),this.counterElement=this.createDOMElement({tagName:"span",textContent:String(f)}),this.currentPageElement=this.createDOMElement({tagName:"p"}),this.addPagination(),this.addPageName(t),this.lastPage=this.currentPage||f}async setPage(t,s){if(t===this.currentPage)return;this.currentPage=t||this.currentPage,this.setPageNumber();const r=await this.getPaginationData();this.setElementsCount(r.count);const i=this.lastPage;if(this.setLastPage(r.count),this.currentPage>this.lastPage&&(this.currentPage=this.lastPage+f),r.data.length===m&&this.currentPage>f){await this.setPage(this.currentPage-f);return}this.updateButtonsState(),!(s&&this.currentPage!==i)&&this.eventEmitter.notify({type:h.paginationUpdated,data:r.data})}createElement(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.gap30,o.alignCenter]})}updateButtonsState(){const t=this.currentPage===f,s=this.currentPage===this.lastPage;this.buttons[A.FIRST].disabledElement(t),this.buttons[A.PREVIOUS].disabledElement(t),this.buttons[A.NEXT].disabledElement(s),this.buttons[A.LAST].disabledElement(s)}setLastPage(t){this.lastPage=Math.ceil(t/this.limit)||f}setPageNumber(){this.currentPageElement.textContent=String(this.currentPage)}setElementsCount(t){this.counterElement.textContent=String(t)}addPagination(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.justifyBetween,o.alignCenter]});this.createPaginationButtons(),t.append(this.buttons[A.FIRST].getElement(),this.buttons[A.PREVIOUS].getElement(),this.currentPageElement,this.buttons[A.NEXT].getElement(),this.buttons[A.LAST].getElement()),this.appendElement(t)}createPaginationButtons(){for(const t of this.buttonsConfig){const s=new G({title:R[t.name],path:D[t.name],classList:[I.icon]},t.callback);this.buttons[t.name]=s,s.addRaceListeners()}}addPageName(t){const s=this.createDOMElement({tagName:"p",textContent:t}),r=document.createTextNode(K.BRACKET.OPEN),i=document.createTextNode(K.BRACKET.CLOSE);s.append(r,this.counterElement,i),this.appendElement(s)}}class Pe extends Ct{constructor(){super(pt.GARAGE);n(this,"limit");n(this,"eventEmitter");n(this,"apiHandler");n(this,"validator",E.getInstance().getService(c.VALIDATOR));const t=E.getInstance();this.eventEmitter=t.getService(c.EVENT_EMITTER),this.apiHandler=t.getService(c.GARAGE),this.limit=jt,this.registerEvent(h.listUpdated,async s=>{if(!Array.isArray(s))return;const[r,i]=s;(this.validator.validate(l.number,r)||r===null)&&(this.validator.validate(l.boolean,i)||i===void 0)&&await this.setPage(r,i).catch(g)}),this.setPage(null).catch(g)}async getPaginationData(){let t;try{t=await this.apiHandler.getPage({page:this.currentPage,limit:this.limit})}catch(s){g(s)}if(!t)throw new Error(p.INVALID_DATA);return t}}class Le extends C{constructor(){super();n(this,"buttonsConfig",[{title:F.START_RACE,callback:()=>{this.raceService.startRace().catch(g)}},{title:F.RESET,callback:()=>{this.raceService.stopRace().catch(g)}},{title:F.GENERATE_CARS,callback:()=>{this.generateCars().catch(g)}}]);n(this,"garageService");n(this,"pagination");n(this,"raceService");const t=new _e,s=E.getInstance();this.raceService=s.getService(c.RACE),this.garageService=s.getService(c.GARAGE),this.pagination=new Pe,this.appendElement(this.pagination.getElement(),this.createUIPanel(),t.getElement())}createElement(){return this.createDOMElement({tagName:"div",classList:[o.container,o.flex,o.gap30,o.flexColumn,o.alignCenter]})}addButtons(t){for(const{title:s,callback:r}of this.buttonsConfig){let i;i=new G({title:R[s],path:D[s],classList:[]},r),s===F.RESET?(i.registerEvent(h.enginesStarted,()=>{i.disabledElement(!1)}),i.registerEvent(h.singleRaceStarted,()=>{i.disabledElement(!1)}),i.registerEvent(h.raceEnded,()=>{i.disabledElement(!0)}),i.disabledElement(!0),i.addListener(()=>i.disabledElement(!0))):i.addRaceListeners(),t.append(i.getElement())}}createUIPanel(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.justifyBetween,o.alignCenter,o.widthFull,gt.uiPanel]}),s=new we;return t.append(s.getElement(),this.createButtonWrapper()),t}createButtonWrapper(){const t=this.createDOMElement({tagName:"div",classList:[gt.buttonWrapper,o.flex,o.alignCenter,o.gap20]});return this.addButtons(t),t}async generateCars(){const t=[];for(let s=m;s<$t;s++){const r=De(),i=it(),d=this.garageService.createCar({name:r,color:i}).catch(g);t.push(d)}await Promise.all(t),this.pagination.setPage(null,!0)}}class ye extends C{constructor(){super();n(this,"homeButton");this.homeButton=new ft(R.TO_GARAGE,()=>E.getInstance().getService(c.ROUTER).navigateTo(O.HOME)),this.appendElement(this.homeButton.getElement())}createElement(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.container,o.flexColumn,o.center,o.gap30]}),s=this.createDOMElement({tagName:"p",textContent:k.PAGE_NOT_FOUND});return t.append(s),t}}class Me extends Ct{constructor(t,s){super(pt.WINNERS);n(this,"limit");n(this,"order");n(this,"sort");n(this,"eventEmitter");n(this,"apiHandler");const r=E.getInstance();this.eventEmitter=r.getService(c.EVENT_EMITTER),this.apiHandler=r.getService(c.WINNER),this.limit=Xt,this.order=t,this.sort=s,this.setPage(null).catch(g)}setOrder(t){this.order=t,this.setPage(null).catch(g)}setSort(t){this.sort=t,this.setPage(null).catch(g)}getPaginationData(){return this.apiHandler.getPage({page:this.currentPage,limit:this.limit,order:this.order,sort:this.sort})}}const xe="_filter_1vyyc_38",Ge="_orderIcon_1vyyc_52",Be="_orderIconRotate_1vyyc_57",We="_table_1vyyc_62",Ve="_tableHeader_1vyyc_67",Fe="_tableData_1vyyc_68",Ue="_tableRow_1vyyc_79",v={filter:xe,orderIcon:Ge,orderIconRotate:Be,table:We,tableHeader:Ve,tableData:Fe,tableRow:Ue};var L=(a=>(a.POST="POST",a.PUT="PUT",a.DELETE="DELETE",a.PATCH="PATCH",a))(L||{}),U=(a=>(a.ASC="ASC",a.DESC="DESC",a))(U||{}),x=(a=>(a.ID="id",a.WINS="wins",a.TIME="time",a))(x||{}),X=(a=>(a.STARTED="started",a.STOPPED="stopped",a.DRIVE="drive",a))(X||{});class He extends C{constructor(){super();n(this,"pagination");n(this,"isASC",!1);n(this,"order");n(this,"sort");n(this,"tableWrapper",this.createDOMElement({tagName:"div"}));n(this,"validator",E.getInstance().getService(c.VALIDATOR));const t=E.getInstance().getService(c.STORAGE);this.isASC=t.load(T.isASC,l.boolean)||!1,this.order=this.isASC?U.ASC:U.DESC,this.sort=t.load(T.sort,l.sort)||x.ID,this.pagination=new Me(this.order,this.sort),this.appendElement(this.pagination.getElement()),this.appendElement(this.createUIPanel()),this.appendElement(this.tableWrapper),window.addEventListener("beforeunload",()=>{t.save(T.isASC,this.isASC),t.save(T.sort,this.sort)}),this.registerEvent(h.changeRoute,()=>{t.save(T.isASC,this.isASC),t.save(T.sort,this.sort)}),this.registerEvent(h.paginationUpdated,s=>{this.validator.validate(l.fullData,s)&&(this.tableWrapper.replaceChildren(),this.createWinnerTable(s))})}createElement(){return this.createDOMElement({tagName:"div",classList:[o.container,o.flex,o.gap30,o.flexColumn,o.alignCenter]})}createOrderButton(){const t=new G({title:R.ORDER,path:D.ORDER,classList:[v.orderIcon]},()=>{this.isASC=!this.isASC;const s=this.isASC?U.ASC:U.DESC;this.pagination.setOrder(s),t.getElement().classList.toggle(v.orderIconRotate,this.isASC)});return t.getElement().classList.toggle(v.orderIconRotate,this.isASC),t}createUIPanel(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.gap20,o.alignCenter,o.widthFull]});return t.append(this.createDropList(),this.createOrderButton().getElement()),t}createDropList(){const t=this.createDOMElement({tagName:"select",classList:[v.filter]});t.addEventListener("change",()=>{this.validator.validate(l.sort,t.value)&&(this.sort=t.value,this.pagination.setSort(this.sort))});for(const s of Object.values(x)){const r=this.createDOMElement({tagName:"option",textContent:s,attributes:{value:s}});s===this.sort&&(r.selected=!0),t.append(r)}return t}createWinnerTable(t){const s=this.createDOMElement({tagName:"table",classList:[v.table,o.widthFull]});this.tableWrapper.append(s),s.append(this.createTableHeader());for(const r of t.values())s.append(this.createTableRow(r));return s}createTableHeader(){const t=zt,s=this.createDOMElement({tagName:"tr",classList:[v.tableRow]});for(const r of t){const i=this.createDOMElement({tagName:"th",textContent:r,classList:[v.tableHeader]});s.append(i)}return s}createTableRow({name:t,color:s,id:r,wins:i,time:d}){const S=this.createDOMElement({tagName:"tr",classList:[v.tableRow]}),_=[r.toString(),s,t,`${i.toString()}${Et.COUNT}`,`${d.toFixed(rt)}${Et.SECONDS}`];for(const w of _){const z=this.createDOMElement({tagName:"td",classList:[v.tableData]});if(w===s){const{use:Tt,svg:It}=this.createSVG({classList:[I.carIcon],path:D.CAR});Tt.setAttribute(nt.FILL,s),z.append(It)}else this.addTextContent(w,z);S.append(z)}return S}}const ke=new Map([[O.HOME,Le],[O.NOT_FOUND,ye],[O.WINNERS,He]]);class $e{constructor(){n(this,"name",c.ROUTER);n(this,"routes",new Map);n(this,"container",null);n(this,"currentPath",mt);globalThis.addEventListener("hashchange",()=>{this.routerChange()})}setContainer(e){return this.container=e,this}addRoutes(e){this.routes=e,this.routerChange()}navigateTo(e){this.currentPath=e,this.clearPage();let t=this.routes.get(e)??this.routes.get(O.NOT_FOUND);if(!t)throw new Error(k.ROUTE_NOT_FOUND);if(globalThis.location.hash=e,!this.container)throw new Error(p.CONTAINER_NOT_FOUND);E.getInstance().getService(c.EVENT_EMITTER).notify({type:h.changeRoute,data:e}),this.container.append(new t().getElement())}clearPage(){if(!this.container)throw new Error(k.ROUTE_NOT_FOUND);this.container.replaceChildren()}routerChange(){const e=globalThis.location.hash.slice(K.HASH.length)||O.HOME;e!==this.currentPath&&this.navigateTo(e)}}const N=class N{constructor(){n(this,"name",c.API);n(this,"baseUrl",Kt);n(this,"headers",qt);n(this,"getData",async e=>{const t=`${this.baseUrl}${e}`;let s;try{s=await N.getResponseData(t)}catch(i){throw new Error(`${p.FETCH}${i}`)}if(!E.getInstance().getService(c.VALIDATOR).validate(l.responseData,s))throw new Error(p.INVALID_DATA);return s});n(this,"deleteData",async e=>{const t=`${this.baseUrl}${e}`;try{await N.getResponse(t,{method:L.DELETE})}catch(s){g(s)}});n(this,"updateData",async(e,t,s)=>await this.sendData(e,t,L.PUT,s));n(this,"createData",async(e,t,s)=>await this.sendData(e,t,L.POST,s));n(this,"patchData",async(e,t,s)=>await this.sendData(e,t,L.PATCH,s));n(this,"sendData",async(e,t,s,r)=>{const i=`${this.baseUrl}${e}`,d={method:s,signal:r};s!==L.PATCH&&(d.headers=this.headers,d.body=JSON.stringify(t));const S=await N.getResponse(i,d);if(!S.ok)throw S;return await S.json()})}static getTotalCountCars(e){const t=e.headers.get(Yt);return t?Number(t):m}};n(N,"getResponse",async(e,t)=>{var r;const s=await fetch(e,t);if((r=t==null?void 0:t.signal)!=null&&r.aborted)throw new Error(p.ABORTED);return s}),n(N,"getResponseData",async(e,t)=>{const s=await N.getResponse(e,t);let r;if(!s.ok)throw s;if(r=N.getTotalCountCars(s),r<m)throw new Error(p.INVALID_DATA);return{data:await s.json(),count:r}});let st=N;class je{constructor(e){n(this,"animation",null);n(this,"isAnimating",!1);this.car=e}animate(e,t){this.isAnimating=!0,this.animation=this.car.animate([{transform:`translateX(${m}px)`},{transform:`translateX(${e}px)`}],{duration:t,fill:te})}pause(){var e;(e=this.animation)==null||e.pause()}stop(){var e;this.isAnimating=!1,(e=this.animation)==null||e.cancel()}async reverse(e,t){!this.animation||!this.isAnimating||(this.animation.updatePlaybackRate(e),this.animation.reverse(),this.animation.onfinish=()=>{this.onfinish(t)})}onfinish(e){var t;(t=this.animation)==null||t.reverse(),this.stop(),e&&e()}}class ot{constructor(){n(this,"name",c.RACE);n(this,"diContainer",E.getInstance());n(this,"engineService",this.diContainer.getService(c.ENGINE));n(this,"eventEmitter",this.diContainer.getService(c.EVENT_EMITTER));n(this,"cars",{});n(this,"distance",m);n(this,"container",null);n(this,"raceStack",[]);n(this,"abortControllers",new Map)}static calculateDuration(e){return e.velocity>m?e.distance/e.velocity:m}init(e){this.container=e}addCar(e,t){this.cars[e]={id:e,element:t,duration:m}}resetCars(){this.distance=m,this.cars={}}async startSingleRace(e){this.eventEmitter.notify({type:h.singleRaceStarted,data:e}),this.raceStack.push(e),await this.startEngine(e),await this.startAnimation(e)}async stopSingleRace(e,t=!1){var S,_;const s=this.cars[e],r=s.duration*rt/lt;let i;i=()=>{var w;(w=this.abortControllers.get(e))==null||w.abort(p.RACE_STOPPED),this.abortControllers.delete(e)},(S=s.animation)==null||S.reverse(r,i),await this.engineService.stop(e),(_=s.animation)==null||_.stop(),this.eventEmitter.notify({type:h.singleRaceEnded,data:e});const d=this.raceStack.indexOf(e);d>=m&&this.raceStack.splice(d,f),this.distance=m,this.raceStack.length===m&&!t&&this.eventEmitter.notify({type:h.raceEnded})}async stopRace(){const e=[],t=[...this.raceStack];for(const s of t)e.push(this.stopSingleRace(s,!0));try{await Promise.allSettled(e)}catch(s){g(s)}this.eventEmitter.notify({type:h.raceEnded})}async startRace(){this.abortControllers.clear();const e=[],t=[];this.eventEmitter.notify({type:h.raceStarted});for(const i in this.cars){const d=this.startEngine(Number(i));e.push(d),t.push(d.then(()=>this.startAnimation(Number(i)))),this.raceStack.push(Number(i))}Promise.allSettled(e).then(()=>{this.eventEmitter.notify({type:h.enginesStarted})});const s=this.raceStack.length;let r;try{r=await Promise.any(t)}catch(i){g(i)}r&&s>f&&this.abortControllers.size===s&&await this.diContainer.getService(c.WINNER).create({id:r,wins:f,time:this.cars[r].duration/lt})}async startEngine(e){const t=await this.engineService.start(e);this.cars[e].duration=ot.calculateDuration(t),this.distance===m&&this.container&&(this.distance=this.container.clientWidth-this.cars[e].element.clientWidth)}async startAnimation(e){var s,r;const t=this.cars[e];t.animation||(t.animation=new je(t.element)),(s=t.animation)==null||s.animate(this.distance,t.duration);try{return await this.drive(e),e}catch(i){throw(r=this.cars[e].animation)==null||r.pause(),i}}async drive(e){const t=new AbortController;this.abortControllers.set(e,t),await this.engineService.drive(e,t.signal)}}class Xe{constructor(){n(this,"name",c.EVENT_EMITTER);n(this,"observers",new Map);n(this,"subscribe",(e,t)=>{this.observers.has(e)||this.observers.set(e,[]);const s=this.observers.get(e);s==null||s.push(t)})}notify(e){const t=this.observers.get(e.type);if(t)for(const s of t)s.update(e)}}class ct{constructor(){n(this,"name",c.WINNER);n(this,"url",Z.WINNERS);n(this,"apiService");n(this,"diContainer");n(this,"validator");n(this,"getPage",async e=>{const t=new URLSearchParams({_page:String(e.page),_limit:String(e.limit),_sort:e.sort,_order:e.order}),s=`${this.url}?${t}`;let r;if(r=await this.apiService.getData(s),!this.validator.validate(l.responseWinnerData,r))throw new Error(p.INVALID_DATA);const i={count:r.count,data:[]};for(const{id:d}of r.data){const S=await this.diContainer.getService(c.GARAGE).getCar(d),_=r.data.find(w=>w.id===d);_&&i.data.push({..._,...S})}return i});this.diContainer=E.getInstance(),this.apiService=this.diContainer.getService(c.API),this.validator=this.diContainer.getService(c.VALIDATOR)}static createData(e,t){return t?{id:e.id,wins:e.wins+t.wins,time:Math.min(e.time,t.time)}:e}async deleteWinner(e){const t=`${this.url}/${e}`;this.apiService.deleteData(t)}async create(e){let t,s=!1;try{t=await this.getWinner(e.id)}catch{s=!0}finally{const r=ct.createData(e,t),i=s?this.url:`${this.url}/${e.id}`;s?this.apiService.createData(i,r):this.apiService.updateData(i,r),this.notify(r)}}async notify(e){const t=e.id,s=await this.diContainer.getService(c.GARAGE).getCar(t);this.diContainer.getService(c.EVENT_EMITTER).notify({type:h.winnerDetected,data:{name:s.name,id:t,time:e.time}})}async getWinner(e){const t=`${this.url}/${e}`;let s;if(s=await this.apiService.getData(t),!this.validator.validate(l.responseData,s)||!this.validator.validate(l.winner,s.data))throw new Error(p.INVALID_DATA);return s.data}}class Ke{constructor(){n(this,"name",c.GARAGE);n(this,"url",Z.GARAGE);n(this,"apiService");n(this,"winnerService");n(this,"eventEmitter");n(this,"validator");n(this,"getPage",async e=>{const t=new URLSearchParams({_page:String(e.page),_limit:String(e.limit)}),s=`${this.url}?${t}`;let r;if(r=await this.apiService.getData(s),!this.validator.validate(l.responseCarData,r))throw new Error(p.INVALID_DATA);return r});n(this,"createCar",async e=>await this.apiService.createData(this.url,e));n(this,"updateCar",async({id:e,...t})=>{const s=`${this.url}/${e}`;await this.apiService.updateData(s,t),this.eventEmitter.notify({type:h.updateCar,data:{id:e,...t}})});const e=E.getInstance();this.apiService=e.getService(c.API),this.winnerService=e.getService(c.WINNER),this.eventEmitter=e.getService(c.EVENT_EMITTER),this.validator=e.getService(c.VALIDATOR)}async deleteCar(e){const t=`${this.url}/${e}`;await this.apiService.deleteData(t),this.winnerService.deleteWinner(e)}async getCar(e){const t=`${this.url}/${e}`;let s;if(s=await this.apiService.getData(t),!this.validator.validate(l.responseData,s)||!this.validator.validate(l.car,s.data))throw new Error(p.INVALID_DATA);return s.data}}class qe{constructor(){n(this,"name",c.ENGINE);n(this,"url",Z.ENGINE);n(this,"apiService");n(this,"validator");n(this,"requestEngine",async(e,t,s)=>{const r=new URLSearchParams({id:String(t),status:e}),i=`${this.url}?${r}`;let d;if(d=await this.apiService.patchData(i,{method:L.PATCH,signal:s}),!this.validator.validate(l.raceData,d))throw new Error(p.INVALID_DATA);return d});const e=E.getInstance();this.apiService=e.getService(c.API),this.validator=e.getService(c.VALIDATOR)}async start(e){return await this.requestEngine(X.STARTED,e)}async stop(e){return await this.requestEngine(X.STOPPED,e)}async drive(e,t){try{await this.requestEngine(X.DRIVE,e,t)}catch(s){if(s instanceof Error&&s.message===p.INVALID_DATA)return e;throw s}return e}}class Ye{constructor(){n(this,"name",c.STORAGE);n(this,"prefix",kt);n(this,"validator",E.getInstance().getService(c.VALIDATOR))}save(e,t){const s=this.prefix+e;globalThis.sessionStorage.setItem(s,JSON.stringify(t))}load(e,t){const s=this.prefix+e,r=globalThis.sessionStorage.getItem(s);if(!r)return null;try{const i=JSON.parse(r);return this.validator.validate(t,i)?i:null}catch{return null}}}class H{constructor(){n(this,"name",c.VALIDATOR);n(this,"privateTypes",{object:l.object,string:l.string,number:l.number,boolean:l.boolean});n(this,"typesConfig",{[l.object]:e=>this.isObject(e),[l.string]:e=>this.isString(e),[l.number]:e=>this.isNumber(e),[l.positiveNumber]:e=>this.isPositiveNumber(e),[l.boolean]:e=>this.isBoolean(e),[l.responseCarData]:e=>this.isResponseCarData(e),[l.responseWinnerData]:e=>this.isResponseWinnerData(e),[l.responseData]:e=>this.isResponseData(e),[l.raceData]:e=>this.isRaceData(e),[l.carArray]:e=>this.isCarArray(e),[l.winnerArray]:e=>this.isWinnerArray(e),[l.car]:e=>this.isCar(e),[l.winner]:e=>this.isWinner(e),[l.carProperties]:e=>this.isCarProperties(e),[l.modalData]:e=>this.isModelData(e),[l.sort]:H.isSort,[l.fullData]:e=>this.isFullData(e)})}static isArrayOf(e,t){return Array.isArray(e)&&e.every(s=>t(s))}static isSort(e){return e===x.ID||e===x.TIME||e===x.WINS}validate(e,t){return this.typesConfig[e](t)}isObject(e){return typeof e===this.privateTypes.object&&e!==null}isString(e){return typeof e===this.privateTypes.string}isNumber(e){return typeof e===this.privateTypes.number}isBoolean(e){return typeof e===this.privateTypes.boolean}isPositiveNumber(e){return this.isNumber(e)&&e>=m}isResponseCarData(e){return this.isResponseData(e)?this.isCarArray(e.data):!1}isResponseWinnerData(e){return this.isResponseData(e)?this.isWinnerArray(e.data):!1}isResponseData(e){return this.isObject(e)?dt.DATA in e&&dt.COUNT in e:!1}isRaceData(e){return!this.isObject(e)||!(ht.DISTANCE in e&&ht.VELOCITY in e)?!1:this.isPositiveNumber(e.distance)&&this.isPositiveNumber(e.velocity)}isCarArray(e){return H.isArrayOf(e,this.isCar.bind(this))}isWinnerArray(e){return H.isArrayOf(e,this.isWinner.bind(this))}isFullData(e){return this.isCarArray(e)&&this.isWinnerArray(e)}isCar(e){return this.isObject(e)?this.checkCarProperties(e)&&B.ID in e&&this.isPositiveNumber(e.id):!1}isWinner(e){return!this.isObject(e)||!($.ID in e&&$.TIME in e&&$.WINS in e)?!1:this.isPositiveNumber(e.id)&&this.isPositiveNumber(e.time)&&this.isPositiveNumber(e.wins)}isCarProperties(e){return this.checkCarProperties(e)}checkCarProperties(e){return!this.isObject(e)||!(B.NAME in e&&B.COLOR in e)?!1:this.isString(e.name)&&this.isString(e.color)}isModelData(e){return this.isObject(e)?B.ID in e&&this.isPositiveNumber(e.id)&&B.NAME in e&&this.isString(e.name)&&$.TIME in e&&this.isPositiveNumber(e.time):!1}}function Qe(){const a=E.getInstance();a.register(c.ROUTER,$e),a.register(c.API,st),a.register(c.RACE,ot),a.register(c.EVENT_EMITTER,Xe),a.register(c.WINNER,ct),a.register(c.GARAGE,Ke),a.register(c.ENGINE,qe),a.register(c.STORAGE,Ye),a.register(c.VALIDATOR,H)}const Ze="_modal_4dba0_1",Je="_wrapper_4dba0_17",ut={modal:Ze,wrapper:Je};class ze extends C{constructor(){super();n(this,"modalWrapper");this.modalWrapper=this.addWrapper(),this.element.addEventListener("close",()=>{this.element.remove()})}showModal(){document.body.append(this.element);try{this.element.showModal()}catch(t){g(t)}}createElement(){const t=this.createDOMElement({tagName:"dialog",classList:[ut.modal]});return t.addEventListener("click",s=>{s.target===s.currentTarget&&this.element.close()}),t}addWrapper(){const t=this.createDOMElement({tagName:"div",classList:[ut.wrapper,o.flex,o.flexColumn,o.alignCenter,o.gap20]});return this.element.append(t),t}}const M=class M extends ze{constructor(){super();n(this,"modalText",null);this.modalWrapper.append(this.addContent());const t=E.getInstance().getService(c.VALIDATOR);this.registerEvent(h.winnerDetected,s=>{t.validate(l.modalData,s)&&this.showWinnerModal(s)})}static getInstance(){return M.instance||(M.instance=new M),M.instance}showWinnerModal(t){this.changeWinner(t),this.showModal(),setTimeout(()=>{this.element.close()},Qt)}changeWinner(t){this.modalText&&(this.modalText.textContent=`${Zt} ${t.name} ${Jt} ${t.time.toFixed(rt)}s`)}addContent(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.flexColumn,o.alignCenter,o.gap20]}),s=this.createDOMElement({tagName:"p",classList:[]});return this.modalText=s,t.append(s),t}};n(M,"instance");let at=M;function ts(){Qe();const a=document.body,e=new he().addSettingsButton(R.THEME).addPageButton(R.TO_GARAGE).addPageButton(R.TO_WINNERS).getElement(),t=document.createElement("main");a.append(e,t),E.getInstance().getService(c.ROUTER).setContainer(t).addRoutes(ke),at.getInstance()}ts();
//# sourceMappingURL=main-DhS32fEc.js.map
