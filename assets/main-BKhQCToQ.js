var It=Object.defineProperty;var Nt=(a,e,t)=>e in a?It(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>Nt(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const vt="_container_16pco_1",Dt="_flex_16pco_7",Ot="_flexColumn_16pco_11",bt="_alignCenter_16pco_15",_t="_center_16pco_19",wt="_justifyBetween_16pco_28",Pt="_gap30_16pco_37",Lt="_gap20_16pco_41",yt="_gap10_16pco_45",Mt="_widthFull_16pco_58",Bt="_marginInline10_16pco_84",o={container:vt,flex:Dt,flexColumn:Ot,alignCenter:bt,center:_t,justifyBetween:wt,gap30:Pt,gap20:Lt,gap10:yt,widthFull:Mt,marginInline10:Bt},Gt="_headerPrimary_1tw7k_1",xt="_header_1tw7k_1",ct={headerPrimary:Gt,header:xt},R={TO_GARAGE:"To garage",TO_WINNERS:"To winners",PREVIOUS:"Previous page",NEXT:"Next page",FIRST:"First page",LAST:"Last page",START_RACE:"Start race",RESET:"Reset",GENERATE_CARS:"Generate cars",CREATE:"Create",DELETE:"Delete",EDIT:"Edit",START_ENGINE:" Start engine",STOP_ENGINE:"Stop engine",CROSS:"cross",CONFIRM:"confirm",ORDER:"Change sort order",THEME:"theme"},Wt={THEME:"Change theme"},w={NAMESPACE_SVG:"http://www.w3.org/2000/svg",NAMESPACE_XLINK:"http://www.w3.org/1999/xlink",QUALIFIED_NAME:"xlink:href",ROLE:"img"},u="./sprite.svg#",N={SOUND:{ON:u+"sound-on",OFF:u+"sound-off"},THEME:{ON:u+"theme-light",OFF:u+"theme-dark"},DELETE:u+"delete",BACK:u+"back",START_ENGINE:u+"start",STOP_ENGINE:u+"stop",ADD:u+"add",CAR:u+"car2",EDIT:u+"edit",CROSS:u+"cross",CONFIRM:u+"confirm",FIRST:u+"doubleArrowLeft",LAST:u+"doubleArrowRight",NEXT:u+"arrowRight",PREVIOUS:u+"arrowLeft",START_RACE:u+"startRace",RESET:u+"reset",GENERATE_CARS:u+"wheel",ORDER:u+"sort"},Vt={SUBMIT:"submit"},Ut="Async Race",Ft="radomskaia--async-race--",m=0,f=1,at=2,ut="",Ht=100,lt=1e3,q={HASH:"#",BRACKET:{OPEN:"(",CLOSE:")"}},x={RGB:"RGB",RANGE:256,HEX_BASE:16,HEX_LENGTH:2,ZERO_PAD:"0"},O={HOME:"/",WINNERS:"/winners",NOT_FOUND:"404"},H={ROUTE_NOT_FOUND:"Route not found",NOT_INITIALIZED:"Class is not initialized",PAGE_NOT_FOUND:"Sorry, page not found",INVALID_DATA:"Invalid data"};var J=(a=>(a.WINNERS="/winners",a.GARAGE="/garage",a.ENGINE="/engine",a))(J||{});const G={NAME:"name",COLOR:"color",ID:"id"},ht={VELOCITY:"velocity",DISTANCE:"distance"},dt={DATA:"data",COUNT:"count"},$={ID:"id",WINS:"wins",TIME:"time"},kt=7,$t=10,jt="http://localhost:3000",Xt={"Content-Type":"application/json"},Kt="X-Total-Count",qt=4e3,p={PATH_REQUIRED:"Path is required",INVALID_DATA:"Invalid data",NO_LISTENERS:"No listeners for event type",ABORTED:"Aborted",RACE_STOPPED:"Race stopped by user",FETCH:"Error while fetching data: ",SERVICE_NOT_FOUND:"Service not found",INVALID_SERVICE:"Invalid service",CONTAINER_NOT_FOUND:"Container not found"},rt={FILL:"fill",ARIA_LABEL:"aria-label"},Yt="Winner is",Qt="with time",mt={GARAGE:"Garage",WINNERS:"Winners"},Zt=["ID","Car","Name","Wins","Time"],Et={COUNT:"x",SECONDS:"s"},Jt="forwards",D=class D{constructor(){i(this,"services");i(this,"factory");this.services=new Map,this.factory=new Map}static getInstance(){return D.instance||(D.instance=new D),D.instance}static isServiceType(e,t){return t.name===e}register(e,t){this.factory.set(e,t)}getService(e){let t=this.services.get(e);if(!t){const s=this.factory.get(e);if(!s)throw new Error(`${p.SERVICE_NOT_FOUND} ${e}`);t=new s,this.services.set(e,t)}if(!D.isServiceType(e,t))throw new Error(`${p.INVALID_SERVICE} ${e}`);return t}};i(D,"instance");let E=D;var c=(a=>(a.API="apiService",a.RACE="raceService",a.ROUTER="router",a.EVENT_EMITTER="eventEmitter",a.WINNER="winnerService",a.GARAGE="garageService",a.ENGINE="engineService",a.STORAGE="sessionStorage",a.VALIDATOR="validator",a))(c||{});class C{constructor(e){i(this,"element");i(this,"listeners",new Map);i(this,"registerEvent",(e,t)=>{this.listeners.has(e)||this.listeners.set(e,[]);const s=this.listeners.get(e);s==null||s.push(t),E.getInstance().getService(c.EVENT_EMITTER).subscribe(e,this)});i(this,"createDOMElement",({tagName:e,classList:t,textContent:s,attributes:r})=>{const n=document.createElement(e);return t&&this.addClassList(t,n),r&&this.addAttributes(r,n),s&&this.addTextContent(s,n),n});i(this,"addClassList",(e,t)=>{t=t??this.element,t.classList.add(...e)});i(this,"addAttributes",(e,t)=>{t=t??this.element;for(const[s,r]of Object.entries(e))t.setAttribute(s,r)});i(this,"addTextContent",(e,t)=>{t=t??this.element,t.textContent=e});i(this,"createSVG",({path:e,classList:t,attributes:s})=>{const r=document.createElementNS(w.NAMESPACE_SVG,"svg");this.addAttributes({...s,role:w.ROLE},r),this.addClassList(t,r);const n=document.createElementNS(w.NAMESPACE_SVG,"use");return n.setAttributeNS(w.NAMESPACE_XLINK,w.QUALIFIED_NAME,e),r.append(n),{use:n,svg:r}});this.element=this.createElement(e)}update(e){const t=this.listeners.get(e.type);if(!t){console.info(p.NO_LISTENERS);return}for(const s of t)s(e.data)}getElement(){return this.element}appendElement(...e){this.element.append(...e)}clearElement(){this.element.replaceChildren()}}const zt="_button_31epl_1",te="_actionButton_31epl_11",ee="_iconButton_31epl_32",se="_settings_31epl_41",z={button:zt,actionButton:te,iconButton:ee,settings:se};var h=(a=>(a.listUpdated="listUpdated",a.winnerDetected="winnerDetected",a.raceStarted="raceStarted",a.raceEnded="raceEnded",a.singleRaceStarted="singleRaceStarted",a.singleRaceEnded="singleRaceEnded",a.updateCar="updateCar",a.paginationUpdated="paginationUpdated",a.changeRoute="changeRoute",a.enginesStarted="enginesStarted",a))(h||{});class pt extends C{constructor(t){super();i(this,"wasDisabled",{isDisabled:!1,singleStack:[]});t&&this.addListener(t)}toggleDisabled(){this.disabledElement(!this.element.disabled)}disabledElement(t){this.element.disabled=t}addListener(t){this.element.addEventListener("click",t)}createElement(){return this.createDOMElement({tagName:"button",classList:[z.button]})}addRaceListeners(t,s=!1){s?(this.registerEvent(h.singleRaceStarted,r=>{r===t&&(this.wasDisabled.singleStack.push(!0),this.wasDisabled.isDisabled=this.element.disabled,this.disabledElement(!0))}),this.registerEvent(h.singleRaceEnded,r=>{r!==t&&this.wasDisabled||(this.wasDisabled.singleStack.pop(),this.disabledElement(!1))})):this.registerEvent(h.singleRaceStarted,()=>{this.wasDisabled.isDisabled=this.element.disabled,this.disabledElement(!0)}),this.registerEvent(h.raceEnded,()=>{this.wasDisabled.isDisabled&&this.wasDisabled.singleStack.length!==m||this.disabledElement(!1)}),this.registerEvent(h.raceStarted,()=>{this.wasDisabled.isDisabled=this.element.disabled,this.disabledElement(!0)})}}class B extends pt{constructor(t,s){super(s);i(this,"useSVGIcon");this.element.title=t.title;const{use:r,svg:n}=this.createSVG({path:t.path,classList:[z.iconButton,...t.classList],attributes:{title:t.title,[rt.ARIA_LABEL]:t.title}});this.useSVGIcon=r,this.appendElement(n)}}class ae extends B{constructor(e){if(!e.path)throw new Error(p.PATH_REQUIRED);super({title:e.title,classList:e.classList??[],path:e.path}),this.addClassList([z.settings])}togglePath(e){const t=e?this.pathOff:this.pathOn;this.useSVGIcon.setAttributeNS(w.NAMESPACE_XLINK,w.QUALIFIED_NAME,t)}addToggleListener(e){this.addListener(()=>{e.toggle()})}}class re extends ae{constructor(){const t=N.THEME.ON,s=Wt.THEME;super({path:t,title:s});i(this,"pathOn");i(this,"pathOff",N.THEME.OFF);i(this,"title");this.title=s,this.pathOn=t}}class ie{constructor(e){this.button=e,this.button=e}}const ne="(prefers-color-scheme: dark)",oe="data-theme",L=class L extends ie{constructor(t){super(t);i(this,"isOff");i(this,"mediaQueryList");this.mediaQueryList=globalThis.matchMedia(ne),this.isOff=this.mediaQueryList.matches,this.changeTheme(this.isOff),this.mediaQueryList.addEventListener("change",s=>{this.changeTheme(s.matches)})}static getInstance(t){if(!L.instance){if(!t)throw new Error(H.NOT_INITIALIZED);L.instance=new L(t)}return L.instance}toggle(){this.isOff=!this.isOff,this.changeTheme(this.isOff)}changeTheme(t){this.button.togglePath(t),document.body.toggleAttribute(oe,t)}};i(L,"instance");let tt=L;class St extends pt{constructor(e,t){super(t),this.element.textContent=e,this.addClassList([z.actionButton])}}class ce extends C{constructor(){super();i(this,"settingsButton",{theme:{button:re,action:tt}});i(this,"settingsWrapper");i(this,"pagesWrapper");i(this,"pagesButtons",[]);i(this,"disabledConfig",{[R.TO_WINNERS]:O.WINNERS,[R.TO_GARAGE]:O.HOME});this.settingsWrapper=this.createSettingsWrapper(),this.pagesWrapper=this.createPagesWrapper(),this.appendElement(this.pagesWrapper,this.settingsWrapper)}addSettingsButton(t){const s=new this.settingsButton[t].button,r=this.settingsButton[t].action.getInstance(s);return s.addToggleListener(r),this.settingsWrapper.append(s.getElement()),this}addPageButton(t){const s=E.getInstance().getService(c.ROUTER),r=new St(t);return this.pagesButtons.push(r),r.registerEvent(h.changeRoute,n=>{const d=this.disabledConfig[t]===n;r.disabledElement(d)}),r.addListener(()=>{s.navigateTo(this.disabledConfig[t])}),t!==R.TO_GARAGE&&r.addRaceListeners(),this.pagesWrapper.append(r.getElement()),this}createElement(){const t=this.createDOMElement({tagName:"header",classList:[ct.header,o.container,o.flex,o.alignCenter,o.justifyBetween,o.widthFull]}),s=this.createDOMElement({tagName:"h1",textContent:Ut,classList:[ct.headerPrimary]});return t.append(s),t}createSettingsWrapper(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.center,o.gap30,o.marginInline10]})}createPagesWrapper(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.center,o.gap30]})}}const le="_buttonWrapper_5868v_1",he={buttonWrapper:le},de="_carsList_1h9k5_1",Ee="_icon_1h9k5_10",ge="_carIcon_1h9k5_15",ue="_carName_1h9k5_20",me="_carColor_1h9k5_36",pe="_formButton_1h9k5_55",Se="_form_1h9k5_55",v={carsList:de,icon:Ee,carIcon:ge,carName:ue,carColor:me,formButton:pe,form:Se};class ft extends C{constructor(t){super();i(this,"defaultValue",ut);t&&(this.element.value=t)}get value(){return this.element.value}set value(t){this.element.value=t}setDefaultValue(){this.defaultValue=this.element.value}resetValue(){this.element.value=this.defaultValue}toggleDisabled(){this.element.disabled=!this.element.disabled}createElement(){return this.createDOMElement({tagName:"input"})}}const fe="Car name",At={TEXT:"text",COLOR:"color"},Y={CAR_NAME:"name",CAR_COLOR:"color"};class Ae extends ft{constructor(e){super(e),this.element.type=At.TEXT,this.addClassList([v.carName]),this.element.placeholder=fe,this.element.name=Y.CAR_NAME,this.element.required=!0}}class Re extends ft{constructor(e){super(e),this.element.type=At.COLOR,this.addClassList([v.carColor]),this.element.name=Y.CAR_COLOR}}const X={Tesla:["Model X","Model S","Model 3","Model Y","Cybertruck"],BMW:["i3","i4","i8","M4","X5"],Audi:["A3","A4","Q7","Q5","e-tron"],Mercedes:["A-Class","C-Class","E-Class","S-Class","GLC"],Ford:["Mustang","F-150","Explorer","Focus","Bronco"],Toyota:["Camry","Corolla","Highlander","RAV4","Prius"],Honda:["Civic","Accord","CR-V","Pilot","Odyssey"],Chevrolet:["Malibu","Impala","Tahoe","Silverado","Bolt EV"],Volkswagen:["Golf","Passat","Tiguan","ID.4","Beetle"],Nissan:["Altima","Maxima","370Z","Leaf","Rogue"],Hyundai:["Elantra","Sonata","Tucson","Santa Fe","Kona"]},Ce=Object.keys(X);function Te(){return Math.floor(Math.random()*x.RANGE).toString(x.HEX_BASE).padStart(x.HEX_LENGTH,x.ZERO_PAD)}function it(){let a=`${q.HASH}`;for(let e=m;e<x.RGB.length;e++)a+=Te();return a}function Ie(){const a=Math.floor(Math.random()*Object.keys(X).length),e=Ce[a],t=Math.floor(Math.random()*X[e].length),s=X[e][t];return`${e} ${s}`}function g(a){if(a instanceof Error){console.warn(a.message);return}if(a instanceof Response){console.warn(a.statusText);return}if(a instanceof DOMException){console.info(a.message);return}console.warn(a)}var T=(a=>(a.sort="sort",a.isASC="isASC",a.garage="Garage",a.winners="Winners",a.carProperties="CarProperties",a))(T||{}),l=(a=>(a.object="object",a.string="string",a.number="number",a.positiveNumber="positiveNumber",a.boolean="boolean",a.responseCarData="responseCarData",a.responseWinnerData="responseWinnerData",a.responseData="responseData",a.raceData="raceData",a.carArray="carArray",a.winnerArray="winnerArray",a.car="car",a.winner="winner",a.carProperties="carProperties",a.modalData="modalData",a.sort="sort",a.fullData="fullData",a))(l||{});class Q extends C{constructor(t){super(t==null?void 0:t.id);i(this,"nameElement");i(this,"colorElement");i(this,"apiService",E.getInstance().getService(c.GARAGE));i(this,"validator",E.getInstance().getService(c.VALIDATOR));const r=E.getInstance().getService(c.STORAGE).load(T.carProperties,l.carProperties);this.nameElement=this.addCarName((t==null?void 0:t.name)??(r==null?void 0:r.name));const n=(t==null?void 0:t.color)??(r==null?void 0:r.color)??it();this.colorElement=new Re(n),this.appendElement(this.colorElement.getElement(),this.nameElement.getElement())}static createButton(t){return new B({title:R[t],path:N[t],classList:[v.formButton]})}createElement(t){const s=this.createDOMElement({tagName:"form",classList:[v.form]});return this.addClassList([o.flex,o.gap10,o.alignCenter],s),s.addEventListener("submit",r=>this.formHandler(r,t)),s}getFormData(){const t=new FormData(this.element),s=t.get(Y.CAR_NAME),r=t.get(Y.CAR_COLOR);if(!this.validator.validate(l.string,s)||!this.validator.validate(l.string,r))throw new TypeError(H.INVALID_DATA);return{name:s,color:r}}addCarName(t){const s=new Ae(t);return this.appendElement(s.getElement()),s}}var W=(a=>(a.EDIT="EDIT",a.DELETE="DELETE",a.START_ENGINE="START_ENGINE",a.STOP_ENGINE="STOP_ENGINE",a))(W||{}),A=(a=>(a.NEXT="NEXT",a.PREVIOUS="PREVIOUS",a.FIRST="FIRST",a.LAST="LAST",a))(A||{}),Z=(a=>(a.CROSS="CROSS",a.CONFIRM="CONFIRM",a))(Z||{}),V=(a=>(a.START_RACE="START_RACE",a.RESET="RESET",a.GENERATE_CARS="GENERATE_CARS",a))(V||{});class Ne extends Q{constructor(t){super(t);i(this,"formButtons",[]);i(this,"formButtonsConfig",Z);i(this,"eventEmitter",E.getInstance().getService(c.EVENT_EMITTER));i(this,"id");this.addFormButtons(),this.id=t.id,this.colorElement.getElement().addEventListener("change",()=>{this.eventEmitter.notify({type:h.updateCar,data:{id:this.id,name:this.nameElement.value,color:this.colorElement.value}})})}editHandler(){this.getUpdateState()&&(this.toggleUpdateState(),this.nameElement.getElement().focus(),this.colorElement.setDefaultValue(),this.nameElement.setDefaultValue())}formHandler(t,s){t.preventDefault();let r;try{r=this.getFormData()}catch(n){g(n),this.resetForm();return}this.toggleUpdateState(),this.apiService.updateCar({id:s,...r}).catch(n=>{g(n),this.resetForm()})}getUpdateState(){return this.nameElement.getElement().disabled}toggleUpdateState(){this.nameElement.toggleDisabled(),this.colorElement.toggleDisabled();for(const t of this.formButtons)t.toggleDisabled()}addFormButtons(){this.createFormButtons();const[t,s]=this.formButtons;t.addListener(()=>{this.resetForm(),this.toggleUpdateState()}),this.appendElement(s.getElement(),t.getElement()),this.toggleUpdateState()}resetForm(){this.colorElement.resetValue(),this.nameElement.resetValue(),this.eventEmitter.notify({type:h.updateCar,data:{id:this.id,name:this.nameElement.value,color:this.colorElement.value}})}createFormButtons(){for(const t of Object.values(this.formButtonsConfig)){const s=Q.createButton(t);t===Z.CONFIRM&&(s.getElement().type=Vt.SUBMIT),this.formButtons.push(s)}}}class ve extends C{constructor(t){super();i(this,"controlsButtons",{});i(this,"buttonsConfig",[{title:W.DELETE,callback:async()=>{await this.garageService.deleteCar(this.id).catch(g),this.eventEmitter.notify({type:h.listUpdated,data:[null]})},action:t=>t.addRaceListeners(this.id)},{title:W.EDIT,callback:()=>{this.form.editHandler()},action:t=>t.addRaceListeners(this.id)},{title:W.START_ENGINE,callback:()=>{this.raceService.startSingleRace(this.id).catch(g)},action:t=>{t.addRaceListeners(this.id,!0)}},{title:W.STOP_ENGINE,callback:()=>{this.raceService.stopSingleRace(this.id).catch(g)},action:t=>this.registerStopButton(t)}]);i(this,"form");i(this,"useElement");i(this,"carElement");i(this,"garageService");i(this,"raceService");i(this,"eventEmitter");i(this,"id");const s=E.getInstance(),r=s.getService(c.VALIDATOR);this.registerEvent(h.updateCar,S=>{if(!r.validate(l.car,S))throw new Error(p.INVALID_DATA);S.id===t.id&&this.updateCarView(S)}),this.raceService=s.getService(c.RACE),this.garageService=s.getService(c.GARAGE),this.eventEmitter=s.getService(c.EVENT_EMITTER),this.form=new Ne(t),this.id=t.id,this.element.append(this.createCarPanel());const{use:n,svg:d}=this.createSVG({classList:[v.carIcon],path:N.CAR});this.useElement=n,this.carElement=d,this.appendElement(this.carElement),this.updateCarView(t)}getCarElement(){return this.carElement}updateCarView(t){const s=this.useElement;s&&s.setAttribute(rt.FILL,t.color)}createElement(){return this.createDOMElement({tagName:"li",classList:[o.flex,o.flexColumn,o.gap10]})}createCarPanel(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.justifyBetween,o.alignCenter]});return t.append(this.form.getElement(),this.addControlsButtons()),t}createButtonWrapper(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.alignCenter,o.gap10]})}addControlsButtons(){const t=this.createButtonWrapper();for(const{title:s,callback:r,action:n}of this.buttonsConfig){const d=new B({title:R[s],path:N[s],classList:[v.icon]},r);this.appendElement(d.getElement()),this.controlsButtons[s]=d,t.append(d.getElement()),n(d)}return t}registerStopButton(t){t.registerEvent(h.singleRaceStarted,s=>{s===this.id&&t.disabledElement(!1)}),t.registerEvent(h.raceEnded,()=>{t.disabledElement(!0)}),t.registerEvent(h.singleRaceEnded,s=>{s===this.id&&t.disabledElement(!0)}),t.addListener(()=>t.disabledElement(!0)),t.disabledElement(!0)}}class De extends C{constructor(){super();i(this,"raceService");i(this,"addCarsList",t=>{var s;this.clearElement(),(s=this.raceService)==null||s.resetCars();for(const r of t)this.addCar(r)});const t=E.getInstance();this.raceService=t.getService(c.RACE),this.raceService.init(this.element);const s=t.getService(c.VALIDATOR);this.registerEvent(h.paginationUpdated,r=>{s.validate(l.carArray,r)&&this.addCarsList(r)})}addCar(t){const s=new ve(t);this.appendElement(s.getElement()),this.raceService.addCar(t.id,s.getCarElement())}createElement(){return this.createDOMElement({tagName:"ul",classList:[v.carsList,o.flex,o.flexColumn,o.gap20]})}}class Oe extends Q{constructor(){super(),this.addFormButton();const e=E.getInstance().getService(c.STORAGE);window.addEventListener("beforeunload",()=>{e.save(T.carProperties,this.getFormData())}),this.registerEvent(h.changeRoute,()=>{e.save(T.carProperties,this.getFormData())})}formHandler(e){e.preventDefault();let t;try{t=this.getFormData()}catch(s){g(s);return}this.apiService.createCar(t).then(()=>{this.nameElement.resetValue(),this.colorElement.value=it(),E.getInstance().getService(c.EVENT_EMITTER).notify({type:h.listUpdated,data:[null,!0]})}).catch(g)}addFormButton(){const e=Q.createButton(Z.CONFIRM);this.appendElement(e.getElement()),e.addRaceListeners()}}class Rt extends C{constructor(t){super();i(this,"currentPage");i(this,"buttons",{});i(this,"buttonsConfig",[{name:A.FIRST,callback:()=>{this.setPage(f).catch(g)}},{name:A.PREVIOUS,callback:()=>{let t=this.currentPage-f;t=t<=m?f:t,this.setPage(t).catch(g)}},{name:A.NEXT,callback:()=>{let t=this.currentPage+f;t=Math.min(t,this.lastPage),this.setPage(t).catch(g)}},{name:A.LAST,callback:()=>{this.setPage(this.lastPage).catch(g)}}]);i(this,"currentPageElement");i(this,"counterElement");i(this,"lastPage");const s=E.getInstance().getService(c.STORAGE),r=Number(s.load(t,l.positiveNumber));this.currentPage=r||f,window.addEventListener("beforeunload",()=>{s.save(t,this.currentPage)}),this.registerEvent(h.changeRoute,()=>{s.save(t,this.currentPage)}),this.counterElement=this.createDOMElement({tagName:"span",textContent:String(f)}),this.currentPageElement=this.createDOMElement({tagName:"p"}),this.addPagination(),this.addPageName(t),this.lastPage=this.currentPage||f}async setPage(t,s){if(t===this.currentPage)return;this.currentPage=t||this.currentPage,this.setPageNumber();const r=await this.getPaginationData();this.setElementsCount(r.count);const n=this.lastPage;if(this.setLastPage(r.count),this.currentPage>this.lastPage&&(this.currentPage=this.lastPage+f),r.data.length===m&&this.currentPage>f){await this.setPage(this.currentPage-f);return}this.updateButtonsState(),!(s&&this.currentPage!==n)&&this.eventEmitter.notify({type:h.paginationUpdated,data:r.data})}createElement(){return this.createDOMElement({tagName:"div",classList:[o.flex,o.gap30,o.alignCenter]})}updateButtonsState(){const t=this.currentPage===f,s=this.currentPage===this.lastPage;this.buttons[A.FIRST].disabledElement(t),this.buttons[A.PREVIOUS].disabledElement(t),this.buttons[A.NEXT].disabledElement(s),this.buttons[A.LAST].disabledElement(s)}setLastPage(t){this.lastPage=Math.ceil(t/this.limit)||f}setPageNumber(){this.currentPageElement.textContent=String(this.currentPage)}setElementsCount(t){this.counterElement.textContent=String(t)}addPagination(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.justifyBetween,o.alignCenter]});this.createPaginationButtons(),t.append(this.buttons[A.FIRST].getElement(),this.buttons[A.PREVIOUS].getElement(),this.currentPageElement,this.buttons[A.NEXT].getElement(),this.buttons[A.LAST].getElement()),this.appendElement(t)}createPaginationButtons(){for(const t of this.buttonsConfig){const s=new B({title:R[t.name],path:N[t.name],classList:[v.icon]},t.callback);this.buttons[t.name]=s,s.addRaceListeners()}}addPageName(t){const s=this.createDOMElement({tagName:"p",textContent:t}),r=document.createTextNode(q.BRACKET.OPEN),n=document.createTextNode(q.BRACKET.CLOSE);s.append(r,this.counterElement,n),this.appendElement(s)}}class be extends Rt{constructor(){super(mt.GARAGE);i(this,"limit");i(this,"eventEmitter");i(this,"apiHandler");i(this,"validator",E.getInstance().getService(c.VALIDATOR));const t=E.getInstance();this.eventEmitter=t.getService(c.EVENT_EMITTER),this.apiHandler=t.getService(c.GARAGE),this.limit=kt,this.registerEvent(h.listUpdated,async s=>{if(!Array.isArray(s))return;const[r,n]=s;(this.validator.validate(l.number,r)||r===null)&&(this.validator.validate(l.boolean,n)||n===void 0)&&await this.setPage(r,n).catch(g)}),this.setPage(null).catch(g)}async getPaginationData(){let t;try{t=await this.apiHandler.getPage({page:this.currentPage,limit:this.limit})}catch(s){g(s)}if(!t)throw new Error(p.INVALID_DATA);return t}}class _e extends C{constructor(){super();i(this,"buttonsConfig",[{title:V.START_RACE,callback:()=>{this.raceService.startRace().catch(g)}},{title:V.RESET,callback:()=>{this.raceService.stopRace().catch(g)}},{title:V.GENERATE_CARS,callback:()=>{this.generateCars().catch(g)}}]);i(this,"garageService");i(this,"pagination");i(this,"raceService");const t=new De,s=E.getInstance();this.raceService=s.getService(c.RACE),this.garageService=s.getService(c.GARAGE),this.pagination=new be,this.appendElement(this.pagination.getElement(),this.createUIPanel(),t.getElement())}createElement(){return this.createDOMElement({tagName:"div",classList:[o.container,o.flex,o.gap30,o.flexColumn,o.alignCenter]})}addButtons(t){for(const{title:s,callback:r}of this.buttonsConfig){let n;n=new B({title:R[s],path:N[s],classList:[]},r),s===V.RESET?(n.registerEvent(h.enginesStarted,()=>{n.disabledElement(!1)}),n.registerEvent(h.singleRaceStarted,()=>{n.disabledElement(!1)}),n.registerEvent(h.raceEnded,()=>{n.disabledElement(!0)}),n.disabledElement(!0),n.addListener(()=>n.disabledElement(!0))):n.addRaceListeners(),t.append(n.getElement())}}createUIPanel(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.justifyBetween,o.alignCenter,o.widthFull]}),s=new Oe;return t.append(s.getElement(),this.createButtonWrapper()),t}createButtonWrapper(){const t=this.createDOMElement({tagName:"div",classList:[he.buttonWrapper,o.flex,o.alignCenter,o.gap20]});return this.addButtons(t),t}async generateCars(){const t=[];for(let s=m;s<Ht;s++){const r=Ie(),n=it(),d=this.garageService.createCar({name:r,color:n}).catch(g);t.push(d)}await Promise.all(t),this.pagination.setPage(null,!0)}}class we extends C{constructor(){super();i(this,"homeButton");this.homeButton=new St(R.TO_GARAGE,()=>E.getInstance().getService(c.ROUTER).navigateTo(O.HOME)),this.appendElement(this.homeButton.getElement())}createElement(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.container,o.flexColumn,o.center,o.gap30]}),s=this.createDOMElement({tagName:"p",textContent:H.PAGE_NOT_FOUND});return t.append(s),t}}class Pe extends Rt{constructor(t,s){super(mt.WINNERS);i(this,"limit");i(this,"order");i(this,"sort");i(this,"eventEmitter");i(this,"apiHandler");const r=E.getInstance();this.eventEmitter=r.getService(c.EVENT_EMITTER),this.apiHandler=r.getService(c.WINNER),this.limit=$t,this.order=t,this.sort=s,this.setPage(null).catch(g)}setOrder(t){this.order=t,this.setPage(null).catch(g)}setSort(t){this.sort=t,this.setPage(null).catch(g)}getPaginationData(){return this.apiHandler.getPage({page:this.currentPage,limit:this.limit,order:this.order,sort:this.sort})}}const Le="_filter_mc79i_37",ye="_orderIcon_mc79i_51",Me="_orderIconRotate_mc79i_56",j={filter:Le,orderIcon:ye,orderIconRotate:Me};var P=(a=>(a.POST="POST",a.PUT="PUT",a.DELETE="DELETE",a.PATCH="PATCH",a))(P||{}),U=(a=>(a.ASC="ASC",a.DESC="DESC",a))(U||{}),M=(a=>(a.ID="id",a.WINS="wins",a.TIME="time",a))(M||{}),K=(a=>(a.STARTED="started",a.STOPPED="stopped",a.DRIVE="drive",a))(K||{});class Be extends C{constructor(){super();i(this,"pagination");i(this,"isASC",!1);i(this,"order");i(this,"sort");i(this,"tableWrapper",this.createDOMElement({tagName:"div"}));i(this,"validator",E.getInstance().getService(c.VALIDATOR));const t=E.getInstance().getService(c.STORAGE);this.isASC=t.load(T.isASC,l.boolean)||!1,this.order=this.isASC?U.ASC:U.DESC,this.sort=t.load(T.sort,l.sort)||M.ID,this.pagination=new Pe(this.order,this.sort),this.appendElement(this.pagination.getElement()),this.appendElement(this.createUIPanel()),this.appendElement(this.tableWrapper),window.addEventListener("beforeunload",()=>{t.save(T.isASC,this.isASC),t.save(T.sort,this.sort)}),this.registerEvent(h.changeRoute,()=>{t.save(T.isASC,this.isASC),t.save(T.sort,this.sort)}),this.registerEvent(h.paginationUpdated,s=>{this.validator.validate(l.fullData,s)&&(this.tableWrapper.replaceChildren(),this.createWinnerTable(s))})}createElement(){return this.createDOMElement({tagName:"div",classList:[o.container,o.flex,o.gap30,o.flexColumn,o.alignCenter]})}createOrderButton(){const t=new B({title:R.ORDER,path:N.ORDER,classList:[j.orderIcon]},()=>{this.isASC=!this.isASC;const s=this.isASC?U.ASC:U.DESC;this.pagination.setOrder(s),t.getElement().classList.toggle(j.orderIconRotate,this.isASC)});return t.getElement().classList.toggle(j.orderIconRotate,this.isASC),t}createUIPanel(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.gap20,o.alignCenter,o.widthFull]});return t.append(this.createDropList(),this.createOrderButton().getElement()),t}createDropList(){const t=this.createDOMElement({tagName:"select",classList:[j.filter]});t.addEventListener("change",()=>{this.validator.validate(l.sort,t.value)&&(this.sort=t.value,this.pagination.setSort(this.sort))});for(const s of Object.values(M)){const r=this.createDOMElement({tagName:"option",textContent:s,attributes:{value:s}});s===this.sort&&(r.selected=!0),t.append(r)}return t}createWinnerTable(t){const s=this.createDOMElement({tagName:"table"});this.tableWrapper.append(s),s.append(this.createTableHeader());for(const r of t.values())s.append(this.createTableRow(r));return s}createTableHeader(){const t=Zt,s=this.createDOMElement({tagName:"tr"});for(const r of t){const n=this.createDOMElement({tagName:"th",textContent:r});s.append(n)}return s}createTableRow({name:t,color:s,id:r,wins:n,time:d}){const S=this.createDOMElement({tagName:"tr"}),b=[r.toString(),s,t,`${n.toString()}${Et.COUNT}`,`${d.toFixed(at)}${Et.SECONDS}`];for(const _ of b){let k;if(_===s){k=this.createDOMElement({tagName:"td"});const{use:Ct,svg:Tt}=this.createSVG({classList:[v.carIcon],path:N.CAR});Ct.setAttribute(rt.FILL,s),k.append(Tt)}else k=this.createDOMElement({tagName:"td",textContent:_});S.append(k)}return S}}const Ge=new Map([[O.HOME,_e],[O.NOT_FOUND,we],[O.WINNERS,Be]]);class xe{constructor(){i(this,"name",c.ROUTER);i(this,"routes",new Map);i(this,"container",null);i(this,"currentPath",ut);globalThis.addEventListener("hashchange",()=>{this.routerChange()})}setContainer(e){return this.container=e,this}addRoutes(e){this.routes=e,this.routerChange()}navigateTo(e){this.currentPath=e,this.clearPage();let t=this.routes.get(e)??this.routes.get(O.NOT_FOUND);if(!t)throw new Error(H.ROUTE_NOT_FOUND);if(globalThis.location.hash=e,!this.container)throw new Error(p.CONTAINER_NOT_FOUND);E.getInstance().getService(c.EVENT_EMITTER).notify({type:h.changeRoute,data:e}),this.container.append(new t().getElement())}clearPage(){if(!this.container)throw new Error(H.ROUTE_NOT_FOUND);this.container.replaceChildren()}routerChange(){const e=globalThis.location.hash.slice(q.HASH.length)||O.HOME;e!==this.currentPath&&this.navigateTo(e)}}const I=class I{constructor(){i(this,"name",c.API);i(this,"baseUrl",jt);i(this,"headers",Xt);i(this,"getData",async e=>{const t=`${this.baseUrl}${e}`;let s;try{s=await I.getResponseData(t)}catch(n){throw new Error(`${p.FETCH}${n}`)}if(!E.getInstance().getService(c.VALIDATOR).validate(l.responseData,s))throw new Error(p.INVALID_DATA);return s});i(this,"deleteData",async e=>{const t=`${this.baseUrl}${e}`;try{await I.getResponse(t,{method:P.DELETE})}catch(s){g(s)}});i(this,"updateData",async(e,t,s)=>await this.sendData(e,t,P.PUT,s));i(this,"createData",async(e,t,s)=>await this.sendData(e,t,P.POST,s));i(this,"patchData",async(e,t,s)=>await this.sendData(e,t,P.PATCH,s));i(this,"sendData",async(e,t,s,r)=>{const n=`${this.baseUrl}${e}`,d={method:s,signal:r};s!==P.PATCH&&(d.headers=this.headers,d.body=JSON.stringify(t));const S=await I.getResponse(n,d);if(!S.ok)throw S;return await S.json()})}static getTotalCountCars(e){const t=e.headers.get(Kt);return t?Number(t):m}};i(I,"getResponse",async(e,t)=>{var r;const s=await fetch(e,t);if((r=t==null?void 0:t.signal)!=null&&r.aborted)throw new Error(p.ABORTED);return s}),i(I,"getResponseData",async(e,t)=>{const s=await I.getResponse(e,t);let r;if(!s.ok)throw s;if(r=I.getTotalCountCars(s),r<m)throw new Error(p.INVALID_DATA);return{data:await s.json(),count:r}});let et=I;class We{constructor(e){i(this,"animation",null);i(this,"isAnimating",!1);this.car=e}animate(e,t){this.isAnimating=!0,this.animation=this.car.animate([{transform:`translateX(${m}px)`},{transform:`translateX(${e}px)`}],{duration:t,fill:Jt})}pause(){var e;(e=this.animation)==null||e.pause()}stop(){var e;this.isAnimating=!1,(e=this.animation)==null||e.cancel()}async reverse(e,t){!this.animation||!this.isAnimating||(this.animation.updatePlaybackRate(e),this.animation.reverse(),this.animation.onfinish=()=>{this.onfinish(t)})}onfinish(e){var t;(t=this.animation)==null||t.reverse(),this.stop(),e&&e()}}class nt{constructor(){i(this,"name",c.RACE);i(this,"diContainer",E.getInstance());i(this,"engineService",this.diContainer.getService(c.ENGINE));i(this,"eventEmitter",this.diContainer.getService(c.EVENT_EMITTER));i(this,"cars",{});i(this,"distance",m);i(this,"container",null);i(this,"raceStack",[]);i(this,"abortControllers",new Map)}static calculateDuration(e){return e.velocity>m?e.distance/e.velocity:m}init(e){this.container=e}addCar(e,t){this.cars[e]={id:e,element:t,duration:m}}resetCars(){this.distance=m,this.cars={}}async startSingleRace(e){this.eventEmitter.notify({type:h.singleRaceStarted,data:e}),this.raceStack.push(e),await this.startEngine(e),await this.startAnimation(e)}async stopSingleRace(e,t=!1){var S,b;const s=this.cars[e],r=s.duration*at/lt;let n;n=()=>{var _;(_=this.abortControllers.get(e))==null||_.abort(p.RACE_STOPPED),this.abortControllers.delete(e)},(S=s.animation)==null||S.reverse(r,n),await this.engineService.stop(e),(b=s.animation)==null||b.stop(),this.eventEmitter.notify({type:h.singleRaceEnded,data:e});const d=this.raceStack.indexOf(e);d>=m&&this.raceStack.splice(d,f),this.distance=m,this.raceStack.length===m&&!t&&this.eventEmitter.notify({type:h.raceEnded})}async stopRace(){const e=[],t=[...this.raceStack];for(const s of t)e.push(this.stopSingleRace(s,!0));try{await Promise.allSettled(e)}catch(s){g(s)}this.eventEmitter.notify({type:h.raceEnded})}async startRace(){this.abortControllers.clear();const e=[],t=[];this.eventEmitter.notify({type:h.raceStarted});for(const n in this.cars){const d=this.startEngine(Number(n));e.push(d),t.push(d.then(()=>this.startAnimation(Number(n)))),this.raceStack.push(Number(n))}Promise.allSettled(e).then(()=>{this.eventEmitter.notify({type:h.enginesStarted})});const s=this.raceStack.length;let r;try{r=await Promise.any(t)}catch(n){g(n)}r&&s>f&&this.abortControllers.size===s&&await this.diContainer.getService(c.WINNER).create({id:r,wins:f,time:this.cars[r].duration/lt})}async startEngine(e){const t=await this.engineService.start(e);this.cars[e].duration=nt.calculateDuration(t),this.distance===m&&this.container&&(this.distance=this.container.clientWidth-this.cars[e].element.clientWidth)}async startAnimation(e){var s,r;const t=this.cars[e];t.animation||(t.animation=new We(t.element)),(s=t.animation)==null||s.animate(this.distance,t.duration);try{return await this.drive(e),e}catch(n){throw(r=this.cars[e].animation)==null||r.pause(),n}}async drive(e){const t=new AbortController;this.abortControllers.set(e,t),await this.engineService.drive(e,t.signal)}}class Ve{constructor(){i(this,"name",c.EVENT_EMITTER);i(this,"observers",new Map);i(this,"subscribe",(e,t)=>{this.observers.has(e)||this.observers.set(e,[]);const s=this.observers.get(e);s==null||s.push(t)})}notify(e){const t=this.observers.get(e.type);if(t)for(const s of t)s.update(e)}}class ot{constructor(){i(this,"name",c.WINNER);i(this,"url",J.WINNERS);i(this,"apiService");i(this,"diContainer");i(this,"validator");i(this,"getPage",async e=>{const t=new URLSearchParams({_page:String(e.page),_limit:String(e.limit),_sort:e.sort,_order:e.order}),s=`${this.url}?${t}`;let r;if(r=await this.apiService.getData(s),!this.validator.validate(l.responseWinnerData,r))throw new Error(p.INVALID_DATA);const n={count:r.count,data:[]};for(const{id:d}of r.data){const S=await this.diContainer.getService(c.GARAGE).getCar(d),b=r.data.find(_=>_.id===d);b&&n.data.push({...b,...S})}return n});this.diContainer=E.getInstance(),this.apiService=this.diContainer.getService(c.API),this.validator=this.diContainer.getService(c.VALIDATOR)}static createData(e,t){return t?{id:e.id,wins:e.wins+t.wins,time:Math.min(e.time,t.time)}:e}async deleteWinner(e){const t=`${this.url}/${e}`;this.apiService.deleteData(t)}async create(e){let t,s=!1;try{t=await this.getWinner(e.id)}catch{s=!0}finally{const r=ot.createData(e,t),n=s?this.url:`${this.url}/${e.id}`;s?this.apiService.createData(n,r):this.apiService.updateData(n,r),this.notify(r)}}async notify(e){const t=e.id,s=await this.diContainer.getService(c.GARAGE).getCar(t);this.diContainer.getService(c.EVENT_EMITTER).notify({type:h.winnerDetected,data:{name:s.name,id:t,time:e.time}})}async getWinner(e){const t=`${this.url}/${e}`;let s;if(s=await this.apiService.getData(t),!this.validator.validate(l.responseData,s)||!this.validator.validate(l.winner,s.data))throw new Error(p.INVALID_DATA);return s.data}}class Ue{constructor(){i(this,"name",c.GARAGE);i(this,"url",J.GARAGE);i(this,"apiService");i(this,"winnerService");i(this,"eventEmitter");i(this,"validator");i(this,"getPage",async e=>{const t=new URLSearchParams({_page:String(e.page),_limit:String(e.limit)}),s=`${this.url}?${t}`;let r;if(r=await this.apiService.getData(s),!this.validator.validate(l.responseCarData,r))throw new Error(p.INVALID_DATA);return r});i(this,"createCar",async e=>await this.apiService.createData(this.url,e));i(this,"updateCar",async({id:e,...t})=>{const s=`${this.url}/${e}`;await this.apiService.updateData(s,t),this.eventEmitter.notify({type:h.updateCar,data:{id:e,...t}})});const e=E.getInstance();this.apiService=e.getService(c.API),this.winnerService=e.getService(c.WINNER),this.eventEmitter=e.getService(c.EVENT_EMITTER),this.validator=e.getService(c.VALIDATOR)}async deleteCar(e){const t=`${this.url}/${e}`;await this.apiService.deleteData(t),this.winnerService.deleteWinner(e)}async getCar(e){const t=`${this.url}/${e}`;let s;if(s=await this.apiService.getData(t),!this.validator.validate(l.responseData,s)||!this.validator.validate(l.car,s.data))throw new Error(p.INVALID_DATA);return s.data}}class Fe{constructor(){i(this,"name",c.ENGINE);i(this,"url",J.ENGINE);i(this,"apiService");i(this,"validator");i(this,"requestEngine",async(e,t,s)=>{const r=new URLSearchParams({id:String(t),status:e}),n=`${this.url}?${r}`;let d;if(d=await this.apiService.patchData(n,{method:P.PATCH,signal:s}),!this.validator.validate(l.raceData,d))throw new Error(p.INVALID_DATA);return d});const e=E.getInstance();this.apiService=e.getService(c.API),this.validator=e.getService(c.VALIDATOR)}async start(e){return await this.requestEngine(K.STARTED,e)}async stop(e){return await this.requestEngine(K.STOPPED,e)}async drive(e,t){try{await this.requestEngine(K.DRIVE,e,t)}catch(s){if(s instanceof Error&&s.message===p.INVALID_DATA)return e;throw s}return e}}class He{constructor(){i(this,"name",c.STORAGE);i(this,"prefix",Ft);i(this,"validator",E.getInstance().getService(c.VALIDATOR))}save(e,t){const s=this.prefix+e;globalThis.sessionStorage.setItem(s,JSON.stringify(t))}load(e,t){const s=this.prefix+e,r=globalThis.sessionStorage.getItem(s);if(!r)return null;try{const n=JSON.parse(r);return this.validator.validate(t,n)?n:null}catch{return null}}}class F{constructor(){i(this,"name",c.VALIDATOR);i(this,"privateTypes",{object:l.object,string:l.string,number:l.number,boolean:l.boolean});i(this,"typesConfig",{[l.object]:e=>this.isObject(e),[l.string]:e=>this.isString(e),[l.number]:e=>this.isNumber(e),[l.positiveNumber]:e=>this.isPositiveNumber(e),[l.boolean]:e=>this.isBoolean(e),[l.responseCarData]:e=>this.isResponseCarData(e),[l.responseWinnerData]:e=>this.isResponseWinnerData(e),[l.responseData]:e=>this.isResponseData(e),[l.raceData]:e=>this.isRaceData(e),[l.carArray]:e=>this.isCarArray(e),[l.winnerArray]:e=>this.isWinnerArray(e),[l.car]:e=>this.isCar(e),[l.winner]:e=>this.isWinner(e),[l.carProperties]:e=>this.isCarProperties(e),[l.modalData]:e=>this.isModelData(e),[l.sort]:F.isSort,[l.fullData]:e=>this.isFullData(e)})}static isArrayOf(e,t){return Array.isArray(e)&&e.every(s=>t(s))}static isSort(e){return e===M.ID||e===M.TIME||e===M.WINS}validate(e,t){return this.typesConfig[e](t)}isObject(e){return typeof e===this.privateTypes.object&&e!==null}isString(e){return typeof e===this.privateTypes.string}isNumber(e){return typeof e===this.privateTypes.number}isBoolean(e){return typeof e===this.privateTypes.boolean}isPositiveNumber(e){return this.isNumber(e)&&e>=m}isResponseCarData(e){return this.isResponseData(e)?this.isCarArray(e.data):!1}isResponseWinnerData(e){return this.isResponseData(e)?this.isWinnerArray(e.data):!1}isResponseData(e){return this.isObject(e)?dt.DATA in e&&dt.COUNT in e:!1}isRaceData(e){return!this.isObject(e)||!(ht.DISTANCE in e&&ht.VELOCITY in e)?!1:this.isPositiveNumber(e.distance)&&this.isPositiveNumber(e.velocity)}isCarArray(e){return F.isArrayOf(e,this.isCar.bind(this))}isWinnerArray(e){return F.isArrayOf(e,this.isWinner.bind(this))}isFullData(e){return this.isCarArray(e)&&this.isWinnerArray(e)}isCar(e){return this.isObject(e)?this.checkCarProperties(e)&&G.ID in e&&this.isPositiveNumber(e.id):!1}isWinner(e){return!this.isObject(e)||!($.ID in e&&$.TIME in e&&$.WINS in e)?!1:this.isPositiveNumber(e.id)&&this.isPositiveNumber(e.time)&&this.isPositiveNumber(e.wins)}isCarProperties(e){return this.checkCarProperties(e)}checkCarProperties(e){return!this.isObject(e)||!(G.NAME in e&&G.COLOR in e)?!1:this.isString(e.name)&&this.isString(e.color)}isModelData(e){return this.isObject(e)?G.ID in e&&this.isPositiveNumber(e.id)&&G.NAME in e&&this.isString(e.name)&&$.TIME in e&&this.isPositiveNumber(e.time):!1}}function ke(){const a=E.getInstance();a.register(c.ROUTER,xe),a.register(c.API,et),a.register(c.RACE,nt),a.register(c.EVENT_EMITTER,Ve),a.register(c.WINNER,ot),a.register(c.GARAGE,Ue),a.register(c.ENGINE,Fe),a.register(c.STORAGE,He),a.register(c.VALIDATOR,F)}const $e="_modal_4dba0_1",je="_wrapper_4dba0_17",gt={modal:$e,wrapper:je};class Xe extends C{constructor(){super();i(this,"modalWrapper");this.modalWrapper=this.addWrapper(),this.element.addEventListener("close",()=>{this.element.remove()})}showModal(){document.body.append(this.element);try{this.element.showModal()}catch(t){g(t)}}createElement(){const t=this.createDOMElement({tagName:"dialog",classList:[gt.modal]});return t.addEventListener("click",s=>{s.target===s.currentTarget&&this.element.close()}),t}addWrapper(){const t=this.createDOMElement({tagName:"div",classList:[gt.wrapper,o.flex,o.flexColumn,o.alignCenter,o.gap20]});return this.element.append(t),t}}const y=class y extends Xe{constructor(){super();i(this,"modalText",null);this.modalWrapper.append(this.addContent());const t=E.getInstance().getService(c.VALIDATOR);this.registerEvent(h.winnerDetected,s=>{t.validate(l.modalData,s)&&this.showWinnerModal(s)})}static getInstance(){return y.instance||(y.instance=new y),y.instance}showWinnerModal(t){this.changeWinner(t),this.showModal(),setTimeout(()=>{this.element.close()},qt)}changeWinner(t){this.modalText&&(this.modalText.textContent=`${Yt} ${t.name} ${Qt} ${t.time.toFixed(at)}s`)}addContent(){const t=this.createDOMElement({tagName:"div",classList:[o.flex,o.flexColumn,o.alignCenter,o.gap20]}),s=this.createDOMElement({tagName:"p",classList:[]});return this.modalText=s,t.append(s),t}};i(y,"instance");let st=y;function Ke(){ke();const a=document.body,e=new ce().addSettingsButton(R.THEME).addPageButton(R.TO_GARAGE).addPageButton(R.TO_WINNERS).getElement(),t=document.createElement("main");a.append(e,t),E.getInstance().getService(c.ROUTER).setContainer(t).addRoutes(Ge),st.getInstance()}Ke();
//# sourceMappingURL=main-BKhQCToQ.js.map
